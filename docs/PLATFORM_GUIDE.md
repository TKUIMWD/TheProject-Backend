# 資安攻防演練平台 - 平台功能指南

> 本文件提供給 AI 助理,用於向用戶介紹平台功能、使用方式和操作流程。

---

## 目錄

1. [平台簡介](#平台簡介)
2. [用戶角色與權限](#用戶角色與權限)
3. [主要功能模組](#主要功能模組)
4. [詳細功能說明](#詳細功能說明)
5. [常見操作流程](#常見操作流程)
6. [技術規格與限制](#技術規格與限制)

---

## 平台簡介

### 關於平台
政府機關或是中小型企業正在積極培育資安領域人才,現有的資訊安全相關平台都有不同的優勢,像是攻防演練、虛擬機建置管理與知識共享。

同時現有平台少有客製化的虛擬機,有些企業希望能建置更貼近企業環境的虛擬機,且基於隱私與風險的考量希望可以自架、託管企業內部需要的演練平台。

為此我們設計了一個結合現有平台優勢,以及便於設計、管理虛擬機,提供更優質的資安攻防演練/學習平台。

### 核心特色

1. **高度客製化** - 提供客製虛擬機的服務
2. **權限分層** - 一般用戶、管理員、系統管理員身分
3. **多人攻防演練** - 支援多人同時進行攻防演練
4. **資源管理** - 完整的機器與課程管理機制

---

## 👥 用戶角色與權限

### 1. 一般用戶 (User)
- 瀏覽和參與課程
- 建立和管理自己的虛擬機
- 挑戰 Box (CTF 挑戰)
- 建立和分享虛擬機範本
- 查看個人計算資源使用情況

### 2. 管理員 (Admin)
擁有一般用戶的所有權限,額外包括:
- 建立和管理課程
- 提交 Box (CTF 挑戰題目)
- 管理自己建立的課程和內容

### 3. 系統管理員 (SuperAdmin)
擁有最高權限:
- 管理所有用戶帳號
- 審核範本和 Box
- 管理計算資源計畫 (CRP)
- 查看所有機器、範本、課程的總覽
- 系統級別的資源調配

---

## 主要功能模組

### 1. 首頁 (Landing Page)
- 平台介紹輪播圖
- 平台特色展示
- 快速註冊/登入入口

### 2. 課程資源 (Course Resources)
**訪問路徑**: `/CourseResources`

**功能**:
- 瀏覽所有公開課程
- 篩選課程 (難度: Easy/Medium/Hard, 評分)
- 搜尋課程
- 查看課程詳細資訊 (名稱、副標題、時長、難度、評分、講師)
- 加入/退出課程

**課程包含**:
- 課程描述
- 多個章節 (Chapters)
- 每個章節包含虛擬機範本
- 教學內容和實作環境

### 3. Box 資源 (Box Resources)
**訪問路徑**: `/boxResources`

**功能**:
- 瀏覽所有公開的 CTF 挑戰 (Boxes)
- 查看 Box 詳細資訊
- 建立 Box 專屬虛擬機進行挑戰

**Box 特色**:
- 類似 HackTheBox 的 CTF 挑戰平台
- 每個 Box 包含多個 Flag (通關關卡)
- 提供評分和留言功能
- Walkthroughs (過關攻略,完成後可查看)

### 4. 儀表板 (Dashboard)
**訪問路徑**: `/dashboard`

這是用戶的控制中心,包含多個子功能:

#### 4.1 帳號管理
- **個人資訊**: 查看/編輯用戶名、Email、頭像
- **變更密碼**: 修改帳號密碼

#### 4.2 課程管理
**一般用戶**:
- **我的課程**: 查看已加入的課程列表
  
**管理員**:
- **我的課程**: 管理自己建立的課程
- **新增課程**: 建立新課程 (包含課程名稱、副標題、描述、時長、難度、章節)

#### 4.3 機器管理 (VM Management)
- **計算資源**: 查看 CPU、記憶體、磁碟空間的使用情況和配額
- **我的機器**: 
  - 列出所有擁有的虛擬機
  - 查看機器狀態 (運行中/已停止)
  - 啟動/停止/刪除虛擬機
  - 連接到虛擬機終端 (Guacamole 遠端桌面)
- **新增機器**: 從範本建立新的虛擬機
  - 選擇範本
  - 設定機器名稱
  - 配置 CPU 核心數、記憶體大小、磁碟大小

#### 4.4 範本管理 (Template Management)
- **範本列表**: 
  - **私有範本**: 自己建立的範本
  - **公開範本**: 其他用戶分享的範本
  - 查看範本詳細資訊 (CPU、記憶體、磁碟、提交者)
  - 編輯/刪除自己的範本
- **新增範本**: 將現有虛擬機轉換為範本
  - 選擇來源虛擬機
  - 設定範本名稱、描述
  - 設定預設帳號/密碼
  - 配置預設系統規格
  - 選擇公開/私有

#### 4.5 Box 管理 (僅管理員)
- **提交 Box**: 建立新的 CTF 挑戰
  - 選擇基礎範本
  - 設定 Box 描述和設定說明
  - 設定 Flag 數量
  - 提交審核

#### 4.6 訂閱資訊
- **訂閱資訊**: 查看當前計算資源計畫 (CRP)
  - CPU 配額
  - 記憶體配額
  - 磁碟空間配額
  - 可建立的虛擬機數量上限

### 5. 虛擬機終端 (VM Console)
**訪問路徑**: `/vmDetail/:vmId`

**功能**:
- 透過瀏覽器直接操作虛擬機
- 使用 Guacamole 遠端桌面協議
- 支援 VNC/RDP 連線
- 全螢幕模式
- 快速切換近期使用的虛擬機 (左側抽屜)

**特殊功能 - AI 助理**:
- 針對 Box 挑戰提供專屬 AI 提示
- 使用 Box Hint API 獲取通關提示
- 支援 Markdown 格式回應

### 6. 課程詳情頁
**訪問路徑**: `/courses/:courseId`

**功能**:
- 查看課程完整資訊
- 章節列表
- 建立課程專屬虛擬機
- 查看課程提交者資訊

### 7. 章節詳情頁
**訪問路徑**: `/chapters/:chapterId`

**功能**:
- 查看章節內容
- 章節說明文件
- 從章節範本建立虛擬機進行實作
- 導航到其他章節

### 8. Box 詳情頁
**訪問路徑**: `/box/:boxId`

**功能**:
- **總覽 Tab**: 
  - 範本描述
  - Box 資訊與設定說明
  - 系統規格需求 (CPU/記憶體/磁碟)
  - 更新時間
  
- **作答區 Tab**:
  - 提交 Flag (通關密碼)
  - 支援多個 Flag (flag1, flag2, ...)
  - 即時驗證
  
- **留言 Tab**:
  - 查看其他用戶留言
  - 發表評論和心得
  
- **Walkthroughs Tab**:
  - 查看完整過關攻略 (需先完成挑戰)

- **側邊欄**:
  - 建立 Box 專屬虛擬機
  - 查看 Box 擁有者資訊

### 9. 系統管理員控制台
**訪問路徑**: `/superadmin/dashboard` (僅 SuperAdmin)

**功能**:

#### 9.1 帳戶管理
- **用戶總覽**: 
  - 查看所有一般用戶
  - 切換用戶角色 (User ↔ Admin)
  - 調整用戶的計算資源計畫
  - 查看用戶統計 (課程數、VM 數量)
  
- **管理員總覽**:
  - 查看所有管理員
  - 管理管理員權限

#### 9.2 課程管理
- **課程總覽**: 查看所有課程的統計資料

#### 9.3 機器管理
- **機器總覽**: 
  - 查看所有虛擬機
  - 監控系統資源使用狀況

#### 9.4 範本管理
- **範本總覽**: 查看所有範本
- **範本審核**: 
  - 審核用戶提交的公開範本
  - 批准/拒絕範本公開申請

#### 9.5 Box 管理
- **Box 審核**:
  - 審核管理員提交的 Box
  - 批准/拒絕 Box 公開

---

## 詳細功能說明

### 虛擬機 (VM) 生命週期

1. **建立虛擬機**
   - 來源: Box 範本、課程/章節範本、自訂範本
   - 配置: 名稱、CPU 核心數、記憶體大小、磁碟大小
   - 目標: gapvea (PVE 虛擬化平台)
   
2. **虛擬機狀態**
   - `running`: 運行中
   - `stopped`: 已停止
   - 其他狀態由底層 PVE 管理

3. **虛擬機操作**
   - **啟動**: 啟動虛擬機
   - **停止**: 關閉虛擬機
   - **刪除**: 永久刪除虛擬機
   - **連接**: 透過 Guacamole 遠端連線

4. **資源限制**
   - 受計算資源計畫 (CRP) 限制
   - 超出配額無法建立新機器

### 範本 (Template) 系統

1. **範本類型**
   - **私有範本**: 僅創建者可見和使用
   - **公開範本**: 所有用戶可見和使用 (需審核)

2. **範本內容**
   - 基礎虛擬機映像
   - 預設系統規格
   - 預設登入帳號/密碼
   - 描述和使用說明

3. **建立範本流程**
   - 選擇現有虛擬機
   - 配置範本資訊
   - 提交 (公開範本需等待審核)

### Box (CTF 挑戰) 系統

1. **Box 結構**
   - 基於範本的虛擬機
   - 多個 Flag (通關關卡)
   - 描述和設定說明
   - 評分和留言系統

2. **挑戰流程**
   - 瀏覽 Box 列表
   - 查看 Box 詳情
   - 建立 Box 專屬 VM
   - 連接 VM 開始挑戰
   - 找到 Flag 並提交
   - (可選) 發表留言、查看 Walkthroughs

3. **Box 提交與審核**
   - 管理員建立 Box
   - 提交至系統管理員審核
   - 審核通過後公開
   - 可設定拒絕原因

### 課程 (Course) 系統

1. **課程結構**
   ```
   課程 (Course)
   ├── 課程資訊 (名稱、描述、難度、時長)
   └── 多個章節 (Chapters)
       ├── 章節內容
       └── 虛擬機範本
   ```

2. **課程難度**
   - Easy (簡單)
   - Medium (中等)
   - Hard (困難)

3. **課程狀態**
   - `公開`: 所有用戶可見
   - `未公開`: 僅管理員可見
   - `編輯中`: 課程編輯中
   - `審核中`: 等待審核
   - `審核未通過`: 審核被拒絕

### 計算資源計畫 (CRP)

**作用**: 限制用戶可使用的運算資源

**包含配額**:
- CPU 總核心數
- 記憶體總容量 (GB)
- 磁碟空間總容量 (GB)
- 可建立的虛擬機數量上限

**查看方式**:
- Dashboard → 計算資源
- Dashboard → 訂閱資訊

---

## 常見操作流程

### 流程 1: 新用戶入門

1. **註冊帳號** → 首頁點擊「註冊」
2. **驗證 Email** → 收取驗證郵件並點擊連結
3. **登入平台** → 使用帳號密碼登入
4. **瀏覽課程** → 前往「課程資源」頁面
5. **加入課程** → 選擇感興趣的課程加入
6. **建立虛擬機** → 從課程章節建立 VM
7. **開始學習** → 連接 VM 進行實作

### 流程 2: 挑戰 Box (CTF)

1. **前往 Box 資源** → 導航到 `/boxResources`
2. **選擇 Box** → 瀏覽並選擇想挑戰的 Box
3. **查看詳情** → 閱讀 Box 描述和要求
4. **建立虛擬機** → 從 Box 範本建立 VM
5. **連接虛擬機** → 點擊「連接」進入遠端桌面
6. **開始滲透測試** → 在 VM 中尋找 Flag
7. **提交 Flag** → 在「作答區」提交找到的 Flag
8. **完成挑戰** → 所有 Flag 提交成功
9. **(可選) 查看 Walkthroughs** → 學習其他解法

### 流程 3: 建立和分享範本

1. **建立虛擬機** → Dashboard → 新增機器
2. **配置環境** → 連接 VM 並安裝需要的軟體
3. **建立範本** → Dashboard → 新增範本
4. **選擇來源 VM** → 選擇剛才配置好的虛擬機
5. **填寫範本資訊**:
   - 範本名稱
   - 描述
   - 預設帳號/密碼
   - 系統規格
6. **選擇可見性** → 私有 / 公開 (公開需審核)
7. **提交範本** → 等待審核 (如果是公開範本)
8. **審核通過** → 範本可供其他用戶使用

### 流程 4: 管理員建立課程

1. **登入管理員帳號**
2. **前往 Dashboard** → 新增課程
3. **填寫課程資訊**:
   - 課程名稱、副標題
   - 課程描述
   - 時長 (分鐘)
   - 難度 (Easy/Medium/Hard)
4. **新增章節**:
   - 章節標題
   - 章節內容
   - 關聯虛擬機範本
5. **設定課程狀態** → 公開
6. **提交課程**
7. **學員可在課程資源中看到**

### 流程 5: 管理員提交 Box

1. **建立 Box 範本** → 先建立包含挑戰的虛擬機和範本
2. **前往 Dashboard** → Box 管理 → 提交 Box
3. **填寫 Box 資訊**:
   - 選擇基礎範本
   - Box 描述
   - 設定說明
   - Flag 數量
4. **提交審核** → 等待系統管理員審核
5. **審核通過** → Box 公開至 Box 資源
6. **用戶可以開始挑戰**

### 流程 6: 使用 AI 助理

**一般平台問題**:
1. **點擊 AI 助理圖示** → 右下角綠色機器人圖示
2. **輸入問題** → 例如:「如何建立虛擬機?」
3. **獲得回答** → AI 會根據平台功能回答

**Box 挑戰提示** (在 VM 終端頁面):
1. **進入 VM 詳情頁** → `/vmDetail/:vmId`
2. **點擊 AI 助理** → 自動切換為 Box Hint 模式
3. **詢問提示** → 例如:「這個挑戰該從哪裡開始?」
4. **獲得提示** → AI 提供針對該 Box 的提示
5. **繼續挑戰** → 根據提示繼續探索

### 流程 7: 查看和管理計算資源

1. **前往 Dashboard** → 計算資源
2. **查看使用情況**:
   - CPU 使用率進度條
   - 記憶體使用率進度條
   - 磁碟空間使用率進度條
   - 虛擬機數量統計
3. **識別資源瓶頸** → 紅色/黃色警告
4. **優化資源使用**:
   - 刪除不需要的虛擬機
   - 停止閒置的虛擬機
   - 調整虛擬機配置
5. **聯繫管理員** → 如需升級資源計畫

---

## 技術規格與限制

### 虛擬機規格範圍

- **CPU**: 1-16 核心
- **記憶體**: 1-64 GB (單位: MB,需轉換)
- **磁碟**: 10-500 GB

### 存儲單位轉換

- 記憶體輸入: GB
- 記憶體存儲: MB (1 GB = 1024 MB)
- 前端顯示時需要轉換回 GB

### 虛擬化平台

- **底層技術**: Proxmox VE (PVE)
- **目標節點**: `gapvea`
- **遠端協議**: Guacamole (VNC/RDP)

### 訪問控制

所有主要功能頁面都受角色保護:
- **User**: 基礎功能訪問
- **Admin**: User + 課程/Box 管理
- **SuperAdmin**: 完整系統控制

未登入用戶僅能訪問:
- 首頁
- Email 驗證頁
- 忘記密碼頁

### API 端點

平台使用 RESTful API,主要端點包括:

- `/api/v1/auth/*` - 認證相關
- `/api/v1/user/*` - 用戶管理
- `/api/v1/courses/*` - 課程管理
- `/api/v1/chapters/*` - 章節管理
- `/api/v1/vm/*` - 虛擬機資訊
- `/api/v1/vm-operate/*` - 虛擬機操作
- `/api/v1/vm-manage/*` - 虛擬機管理
- `/api/v1/template/*` - 範本管理
- `/api/v1/box/*` - Box 管理
- `/api/v1/ai-chat/platform/guide-stream` - 平台通用 AI 助理
- `/api/v1/ai-chat/box/hint-stream` - Box 挑戰提示

### AI 助理功能

1. **平台導覽模式**:
   - API: `/api/v1/ai-chat/platform/guide-stream`
   - 使用時機: 一般頁面
   - 功能: 回答平台使用問題

2. **Box 提示模式**:
   - API: `/api/v1/ai-chat/box/hint-stream`
   - 使用時機: VM 詳情頁 (`/vmDetail/*`)
   - 功能: 提供 CTF 挑戰提示
   - 參數: `vm_id`, `user_input`

3. **通用特性**:
   - SSE (Server-Sent Events) 串流回應
   - 支援 Markdown 格式
   - 智能滾動控制 (不干擾用戶瀏覽歷史訊息)

---

## AI 助理回答指南

### 回答原則

1. **友善和專業**: 使用友善、專業的語氣
2. **具體明確**: 提供清晰的步驟說明
3. **相關性**: 確保回答與平台功能相關
4. **引導探索**: 鼓勵用戶自己探索和學習

### 回答範例

**問題**: 「如何建立虛擬機?」

**回答**:
```markdown
## 建立虛擬機的步驟

有三種方式可以建立虛擬機:

### 方法 1: 從 Dashboard 建立
1. 前往 **Dashboard** (儀表板)
2. 選擇 **機器管理** → **新增機器**
3. 選擇一個範本 (可從私有範本或公開範本選擇)
4. 填寫虛擬機資訊:
   - 名稱: 給虛擬機取個好記的名字
   - CPU 核心數: 根據需求設定 (預設值通常足夠)
   - 記憶體大小: 單位 GB
   - 磁碟大小: 單位 GB
5. 點擊 **確認** 建立
6. 等待建立完成 (通常需要幾分鐘)
7. 在 **我的機器** 中查看新建立的虛擬機

### 方法 2: 從課程建立
1. 進入 **課程資源**,選擇一門課程
2. 點擊進入課程,查看章節列表
3. 選擇章節進入
4. 點擊側邊欄的 **建立虛擬機** 按鈕
5. 填寫配置並確認

### 方法 3: 從 Box 建立
1. 進入 **Box 資源**
2. 選擇想挑戰的 Box
3. 點擊側邊欄的 **建立虛擬機** 按鈕
4. 系統會自動配置 Box 所需的規格

### 注意事項
建立虛擬機會占用您的計算資源配額,請確保有足夠的:
- CPU 核心數
- 記憶體容量
- 磁碟空間

您可以在 **Dashboard → 計算資源** 查看當前使用情況。
```

---

**問題**: 「Box 是什麼?」

**回答**:
```markdown
## 什麼是 Box?

**Box** 是平台提供的 **CTF (Capture The Flag) 挑戰**,類似 HackTheBox 平台的練習環境。

### Box 的特點

1. **實戰演練環境**
   - 每個 Box 都是一個獨立的虛擬機環境
   - 包含各種資安漏洞和挑戰

2. **Flag 機制**
   - 每個 Box 包含一個或多個 Flag (通關密碼)
   - 找到 Flag 並提交即可證明完成挑戰
   - Flag 通常是特定格式的字串,例如: `FLAG{xxx}`

3. **完整的學習循環**
   - **總覽**: 了解 Box 的描述和系統需求
   - **作答區**: 提交找到的 Flag
   - **留言**: 與其他用戶交流心得
   - **Walkthroughs**: 完成挑戰後可查看詳細攻略

### 如何開始挑戰 Box?

1. 前往 **Box 資源** (`/boxResources`)
2. 瀏覽可用的 Box
3. 選擇一個 Box 查看詳情
4. 點擊側邊欄 **建立虛擬機**
5. 虛擬機建立完成後,前往 **Dashboard → 我的機器**
6. 找到剛建立的虛擬機,點擊 **連接**
7. 開始你的滲透測試之旅!
8. 找到 Flag 後回到 Box 頁面的 **作答區** 提交

### 小提示

如果在挑戰過程中遇到困難:
- 可以在虛擬機終端頁面使用 **AI 助理**
- AI 會提供針對該 Box 的提示 (不會直接給出答案)
- 多思考、多嘗試,這是最好的學習方式!
```

---

**問題**: 「我的資源不足,無法建立虛擬機」

**回答**:
```markdown
## 資源不足的解決方案

### 1. 檢查當前資源使用情況

前往 **Dashboard → 計算資源**,查看:
- **CPU 使用率**: 已使用核心數 / 總配額
- **記憶體使用率**: 已使用記憶體 / 總配額
- **磁碟使用率**: 已使用空間 / 總配額
- **虛擬機數量**: 目前機器數 / 上限

### 2. 釋放資源

如果某項資源已達上限,您可以:

#### 停止閒置的虛擬機
1. 前往 **Dashboard → 我的機器**
2. 找到不需要運行的虛擬機
3. 點擊 **停止** 按鈕
4. 停止虛擬機仍會占用磁碟空間,但會釋放 CPU 和記憶體

#### 刪除不需要的虛擬機
1. 前往 **Dashboard → 我的機器**
2. 找到不再需要的虛擬機
3. 點擊 **刪除** 按鈕
4. 刪除是永久性的,請確認後再操作
5. 刪除會完全釋放該虛擬機占用的所有資源

#### 調整新虛擬機的配置
建立虛擬機時,可以:
- 降低 CPU 核心數
- 減少記憶體大小
- 縮小磁碟空間
- 使用預設配置通常已經足夠

### 3. 升級資源計畫

如果經常遇到資源不足:
1. 查看 **Dashboard → 訂閱資訊**
2. 了解當前的計算資源計畫 (CRP)
3. 聯繫系統管理員申請升級計畫

### 4. 最佳實踐建議

- 不使用的虛擬機及時停止或刪除
- 依需求建立虛擬機,避免過度配置
- 定期檢查資源使用情況
- 優先使用預設的系統規格
```
